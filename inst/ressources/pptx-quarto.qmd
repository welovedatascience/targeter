


```{r}
#| label: setup
#| warning: false
library(data.table)
library(targeter)
library(gt)

# print(params$object)
object <- qs::qread(params$object)
#print(object) 
```


```{r}
stats <- setDT(object$profiles[[1]]$target_stats)
Ntot <- stats[, sum(count)]
if (object$target_type == "binary"){
  stats[, reference_level := ifelse(as.character(value) == as.character(object$target_reference_level), "*", "")]
}
```


## Analysis parameters

:::: {.columns}

::: {.column}
- Data used: `r object$dataname`
- Descrition of data: `r ifelse(!is.null(object$description_data), object$description_data, "no description provided.")`
- Analysis performed the: `r object$date`
- Target: `r paste(object$target, ifelse(!is.null(object$description_target), object$description_target, ""))` [`r object$target_type`]
- Number of variables: `r length(object$profiles)`
- Analysed population contains: `r Ntot` records.
- Analysis performed on: `r paste(object$session$R_version, "with targeter", object$session$targeter_package_version)` 

:::

::: {.column}
```{r}
gt(stats)
```

:::
::::


```{r}
#| output: asis

for (i in seq_along(object$profiles)){
  ivar <- names(object$profiles)[i]
  iprofile <- object$profiles[[ivar]]

  cat("\n\n## ",names(object$profiles)[i],"\n\n")

  print(fullplot(iprofile, which_plot=1:2))
    # which_plot = eval(parse(
    #   text = params$fullplot_which_plot
    # ))))


  cat('\n\n::: {.notes}\n\n')

  kableExtra::kable(table_crossvar(iprofile))
  cat("\n:::\n")
}




```

